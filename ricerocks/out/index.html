<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Home</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Home</h1>

    



    


    <h3> </h3>










    




    <section>
        <article><h1>Game 1: RiceRocks</h1>
<p><q>Writing interactive games and animations is both instructive and fun. Writing such programs is, however,
often challenging. Interactive programs are complex because the user, not the programmer, is in charge of
the program’s execution: the program itself is often a passive receiver of commands, reacting only when some
stimulus in the external world (whether a user’s keystroke or the tick of a clock) occurs.</q> —
<a href="https://world.cs.brown.edu/1/htdw-v1.pdf">How to Design Worlds</a></p>
<p>My original goal with this game was to create a minimalist HTML5 arcade-style game to learn the basics. I translated a
game I originally encountered many years ago in Rice University's
<a href="https://www.coursera.org/learn/interactive-python-1">Interactive Python</a>
Mooc called RiceRocks. This meant the sprites and sounds were all readily available on my PC.</p>
<p>Though translating the game from the original Python to JavaScript wasn't very difficult, it got me thinking on various
<em>philosophical issues</em>, and I kept refactoring until it strayed far from the original.</p>
<h2>Structured Design</h2>
<p><q>Successful design is based on a principle known since the days of Julius Caesar: Divide and conquer.</q> —
<a href="https://www.win.tue.nl/~wstomv/quotes/structured-design.html">Structured Design</a>,
Edward Yourdon and Larry L. Constantine</p>
<p>To avoid a <a href="https://blog.codinghorror.com/the-big-ball-of-mud-and-other-architectural-disasters/">
big ball of mud</a>, the heart of good design is to compose things out of smaller pieces, which if well
designed can then be re-used in other projects.</p>
<p>In software, each of these <em>design units</em> is a separate file. For this game, I split the design
into one <em>main</em> script and three modules.</p>
<p>The main script, game1.js, is the file called by index.html, and to use JavaScript's relatively recent (2015) support of
<a href="https://en.wikipedia.org/wiki/Modular_programming">modular programming</a>, it needs
<code>type=&quot;module&quot;</code> added:</p>
<pre class="prettyprint source lang-html"><code>  &lt;script type=&quot;module&quot; src=&quot;game1.js&quot;>&lt;/script>
</code></pre>
<p>By the way, this only works with served files. If you load an html file statically with a browser, it till complain of
CORS errors if any of its JavaScript files are <code>type=&quot;module&quot;</code>.</p>
<p>I found it confusing that the client that loads modules gets labeled a module, and that the modules themselves
are not listed in the html file, and it took some cursing and frustration to figure this out.</p>
<p>These units are related to unit testing, and one of my goals in this exercise was to learn a JavaScript testing framework,
and I somewhat arbitrarily settled on <a href="https://jasmine.github.io/">Jasmine</a>, which was initially extremely frustrating.</p>
<p>Two traps lay in wait for me with the game1.js file:</p>
<ol>
  <li>The html file Jasmine loads &mdash; its default name is SpecRunner.html &mdash; is not the same as my index.html
with the canvas object and other elements. This meant Jasmine set canvas to null which broke the rest of the code, and
this couldn't be fixed with mocking, or spying as Jasmine calls it, because it happens before the test code is run. </li>
  <li>The main file starts an infinite loop, which in turn freezes Jasmine.</li>
</ol>
<p>This makes the main file which attaches listeners to html elements and launches the animation loop untestable —
at least at my skill level.</p>
<p>But this isn't serious since all the functions which need testing are moved to three modules which the main file
accesses thus:</p>
<pre class="prettyprint source lang-javascript"><code>import { resizeListener, clearScene, drawState } from &quot;./image.js&quot;;
import { playSound } from &quot;./sound.js&quot;;
import { initState, updateState, uiListener } from &quot;./state-loop.js&quot;;
</code></pre>
<p>The decision of what to put in each module Constantine termed
<a href="https://www.win.tue.nl/~wstomv/quotes/structured-design.html#7">cohesion</a>. To me, it seemed natural to
hide all the horrors of the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API">Web Audio API</a>
in one file, exposed to the client as just one function, and similarly the horrors of the
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial">canvas</a> in another.</p>
<p>The guts of the application in game1.js consists of this infinite loop:</p>
<pre class="prettyprint source lang-javascript"><code>function animationLoop() {
  clearScene();
  drawState();
  playSound();
  updateState();
  window.requestAnimationFrame(animationLoop);
}
</code></pre>
<p>Note none of these functions have any arguments. This is due to using what Constantine termed
<a href="https://en.wikipedia.org/wiki/Coupling_(computer_programming)#Module_coupling">global coupling</a>.</p>
<p>I did this project to refresh my JavaScript knowledge after teaching myself Erlang where functions are
not <em>rewritable</em> (or mutable in computer jargon). Erlang uses recursive infinite loops a lot, and these
typically have a compound data structure conventionally called <em>state</em> which gets replaced each
recursion.</p>
<p>From my <a href="https://github.com/roblaing/erlang_mooc/tree/master/doc">notes</a>, a loop which most Erlang
programmers would not write themselves, but use the one provided by the OTP framework, looks something like this:</p>
<pre class="prettyprint source lang-erlang"><code>loop(Module, State0) ->
  receive
    {call, Pid, Ref, Request} ->
      {reply, Reply, State1} = Module:handle_call(Request, {Pid, Ref}, State0),
      Pid ! {reply, Ref, Reply},
      loop(Module, State1);
    {cast, Request} -> 
      {noreply, State1} = Module:handle_cast(Request, State0),
      loop(Module, State1);
    stop -> Module:terminate(normal, State0);
    Unknown ->
      {noreply, State1} = Module:handle_info(Unknown, State0),
      loop(Module, State1)
  end.  
</code></pre>
<p>A reason data is immutable in Erlang is because another processes could be running in another core or another computer,
so they don't share memory. (Among the nice features of Erlang which JavaScript lacks is its is its Module:Function syntax
to remind you what comes from where).</p>
<p>JavaScript's <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers">Web Workers</a>
are Erlangish in that they communicate via <em>message coupling</em>.</p>
<p>Influenced by Erlang, I initially wrote state-loop.js as a web worker, and hit the snag that I couldn't see a way for the
web worker to communicate directly with the animation loop. While the animation loop could post messages to the web worker,
JavaScript doesn't appear to have Erlang's <em>return address</em> mechanism. The animation loop could possibly be made the
web worker's callback function, but I'm not sure how.</p>
<p>Rather than gain any efficiency from moving stuff to a separate thread, the animation got more jerky because of all the
work involved in
<a href="https://en.wikipedia.org/wiki/Coupling_(computer_programming)#Performance_issues">bouncing messages</a>
back and forth 60 times a second instead of simply sharing a reference pointer to
a complex data type representing state. Furthermore, the order of the received messages was shuffled, leading to the
mystery of the vanishing missiles.</p>
<h3>In JavaScript, never create when you can mutate</h3>
<p><q>Since map builds a new array, using it when you aren't using the returned array is an anti-pattern;
use forEach or for-of instead.</q>
— <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map">
MDN's Array.prototype.map()</a> page.</p>
<p>Due to my prejudice against global variables, my initial design was to have the modules share data via function
arguments (This may fall under the jargon term <em>semantic coupling</em>, but as is inevitable in the IT industry,
what was originally a nice, simple concept has been transformed into an unintelligible swamp of BS by consultants).</p>
<p>The canvas object created by image.js was imported by game1.js and accessed by other modules via a function argument.
The <em>state</em> compound data structure which just about every function in every module needs was similarly shared
from state-loop.js with other modules via function arguments.</p>
<p>Ultimately, I came to accept that by attaching the canvas and state objects to
<a href="https://javascript.info/global-object">window</a> — the root, global object in a browser which everything
except a web worker can access — I saved a lot of typing and potential bugs from forgotten function arguments.</p>
<h2>Testability</h2>
<p><q>Testing such programs appears even harder because without the interaction there appears to be no program to speak of,
but automating the testing of interactive programs is especially challenging. Developing clean, well-tested interactive
programs therefore seems especially daunting to beginners.</q> —
<a href="https://world.cs.brown.edu/1/htdw-v1.pdf">How to Design Worlds</a></p>
<p>An advantage of modularity that didn't initially occur to me at first is that it improves testability.</p>
<p>Jasmine's SpecRunner.html — which I moved to a subdirectory called test and renamed index.html — needs to
include a <code>&lt;script type=&quot;module&quot; src=&quot;myTest.js&quot;&gt;&lt;/script&gt;</code> line where <em>myTest.js</em> imports
the functions from the modules to test.</p>
<p>The test script can't see the <em>non-public</em> functions in the module unless they have been added to the export list,
making the interface somewhat confusing. So it's important to document what functions are public for the non-test main script
to import to avoid getting confused.</p>
<pre class="prettyprint source lang-javascript"><code>export { resizeListener, draw, clearScene, paintScene, writeText  // public interfaces
       , getScale, scaleText  // private interfaces added here for testing
       };
</code></pre>
<p>My way to make the canvas object available to the test suite was to add this html to the SpecRunner.html template, which
I moved to a subdirectory called test and renamed index.html:</p>
<pre class="prettyprint source lang-html"><code>&lt;body>
&lt;canvas id=&quot;board&quot;>&lt;/canvas>
&lt;/body>
</code></pre>
<p>To avoid it messing up Jasmine's html report page, I included this stanza in myTest.js:</p>
<pre class="prettyprint source lang-javascript"><code>  afterAll(function() {
    document.body.removeChild(document.querySelector(&quot;#board&quot;));
  });
</code></pre>
<p>Step 1 is to download the latest <a href="https://github.com/jasmine/jasmine/releases">release</a>. Unziping
it produces something like:</p>
<p><code><pre>
./
├── lib/
│   ├── jasmine-3.6.0/jasmine_favicon.png
│   ├── jasmine-3.6.0/jasmine.js
│   ├── jasmine-3.6.0/jasmine-html.js
│   ├── jasmine-3.6.0/jasmine.css
│   └── jasmine-3.6.0/boot.js
├── SpecRunner.html
├── src/
│   ├── Player.js
│   └── Song.js
└── spec/
.   ├── PlayerSpec.js
.   └── SpecHelper.js
</pre></code></p>
<p>I've copied everything in lib/jasmine-3.6.0/ into test/ along with SpecRunner.html renamed index.html.</p>
<h2>Style Tips</h2>
<p>Many of my style tips are frowned upon by JavaScript linters and the
<a href="https://google.github.io/styleguide/jsguide.html">Google JavaScript Style Guide</a>,
but they make sense to me.</p>
<h3>Rule 1: Use strings rather than literals</h3>
<p>I've tried to design my modules so that their exposed function/s (one is ideal) take a one-word string as an argument, which
acts as a mini-<a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL</a> which the public function then uses
to call the relevant function hidden within its black box, along with the relevant associated data.</p>
<p>For the image and sound modules, this string is usually a key whose value is some binary blob associated with a file.</p>
<p>For some reason, JavaScript linters complain about using <code>sounds[&quot;missile&quot;]</code> instead of <code>sounds.missile</code>,
but I think it better style since I can use <code>sounds[Variable]</code> but not <code>sounds.Variable</code>.</p>
<h3>Rule 2: Use leading commas</h3>
<p>A style common in SQL, but frowned in JavaScript and elsewhere is to put separating commas at the front rather than back of
curly bracketed <em>key: value</em> statements, or round bracketed argument lists in functions with too many
or too long parameters.</p>
<p>As primarily a natural language writer, leading commas struck me as alien and ugly at first, but I've grown fond of the
way they make balancing curly, square, and round brackets easier, and make deeply nested data structures easier to
understand.</p>
<p>My way of writing key-value pairs goes like this:</p>
<pre class="prettyprint source lang-javascript"><code>  const button2key = { &quot;leftButton&quot;: &quot;ArrowLeft&quot;
                     , &quot;rightButton&quot;: &quot;ArrowRight&quot;
                     , &quot;upButton&quot;: &quot;ArrowUp&quot;
                     , &quot;spaceBar&quot;: &quot; &quot;
                     };
</code></pre>
<p>String instead of literal keys in the above example are extraneous, but I find when assigning variables to keys,
using the same name is a handy mnemonic. If the key isn't quoted, there's confusion over whether it refers to the value
of the corresponding variable. So as per rule 1, I simply always make my keys strings instead of literals, and reference
their values as button2key[&quot;leftButton&quot;] rather than button2key.leftButton to keep it clear in my mind this is an associative
array, even if JavaScript calls it an object.</p>
<p>Another advantage of keeping keys double quoted is it sticks to the JSON convention.</p>
<h3>Rule 3: Design with <a href="https://en.wikipedia.org/wiki/Functional_programming">FP</a> and modules, avoid
<a href="https://en.wikipedia.org/wiki/Object-oriented_programming">OOP</a> when possible</h3>
<p>While I find some of the rules <a href="https://www.crockford.com/javascript/">Douglas Crockford</a>
put into <a http="https://jslint.com/">jslint</a> and advises in his
<a href="https://www.oreilly.com/library/view/javascript-the-good/9780596517748/">book</a> a bit overly pedantic,
I thoroughly agree with his advice on avoiding the horrors of
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this">this</a>,
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/new">new</a>,
<a href="ttps://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/class">class</a> and
other OOP goop laddled over an otherwise nice, simple language.</p>
<p>Moving from Python to JavaScript, I found it quite eye opening that object-style <code>sounds.missile</code> is
simply syntactic sugar for associative array-style <code>sounds[&quot;missile&quot;]</code>, revealing that much of OOP is simply
compound data layered in jargon.</p>
<p>The OOP way of writing the playSound standalone function would be to create a class with a name like Sound and then
write something like <code>Sound.prototype.playSound = function() {...}</code> to be invoked as
<code>sounds.missile.playSound()</code>, which I find a lot less elegant or reusable than one function, taking
one string as an argument, imported from a module encapsulating everything else.</p>
<h3>Audio</h3>
<p>In my first draft of this project when I struggling to understand the myriad
<a href="https://developer.mozilla.org/en-US/docs/Web/API">Web APIs</a>, I kept one hierarchical diagram with links
to documentation on the many objects and their methods, properties and events I was using. The audio part looked like
this.</p>
<p><code><pre>
├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/BaseAudioContext">BaseAudioContext</a>
│   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioContext#Constructor">Constructor</a>
│   │   └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioContext/AudioContext">AudioContext()</a>
│   └── Properties
│       └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/BaseAudioContext/destination">destination</a>
└── <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioBufferSourceNode">AudioBufferSourceNode</a>
.   ├── Constructor/Instantiator
.   │   └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/BaseAudioContext/createBufferSource">BaseAudioContext.createBufferSource()</a>
.   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioBufferSourceNode#Properties">Properties</a>
.   │   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioBufferSourceNode/buffer">buffer</a>
.   │   └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioBufferSourceNode/loop">loop</a>
.   └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioBufferSourceNode#Methods">Methods</a>
.   .   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioNode/connect">connect()</a>
.   .   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioBufferSourceNode/start">start()</a>
.   .   └── stop()
</pre></code></p>
<p>I'm more of a graphics than sound guy, and I found all the objects required for audio extremely confusing. It's
a bit analogous to graphics in that files containing binary blobs in various formats need to downloaded by the browser
and stored in memory to be referenced by named constants.</p>
<p>A <em>context</em> is needed which is conventionally made a global constant whose methods are used
to make noise when desired.</p>
<p>Thanks to modularisation, I could move all this complexity into a separate file to be access in my main file by</p>
<pre class="prettyprint source lang-javascript"><code>import { playSound } from &quot;./sound.js&quot;;
</code></pre>
<p>where sounds is a key-value store of the four sounds used in the game which can be passed to one function as in</p>
<pre class="prettyprint source lang-javascript"><code>playSound(&quot;missile&quot;);
</code></pre>
<h3>Graphics</h3>
<p>One of the advantages of modularity I discovered here is it that it improves testability, which I find fairly tricky
in a game like this.</p>
<p>Though I couldn't abstract image.js down to just two public names, I similary managed to hide much of this complexity
in a module accessed with a dictionary of key-value pairs and some functions.</p>
<p><code><pre>
├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API">Canvas</a>
│   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement">HTMLCanvasElement</a>
│   │   └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement#Properties">Properties</a>
│   │   .   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/width">width</a>
│   │   .   └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/height">height</a>
│   └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D">CanvasRenderingContext2D</a>
│   .   ├── Constructor/Instantiator
│   .   │   └── <a href="developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/getContext">HTMLCanvasElement.getContext()</a>
│   .   ├── Properties
│   .   │   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/fillStyle">fillStyle</a>
│   .   │   └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/font">font</a>
│   .   └── Methods
│   .   .   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/clearRect">clearRect()</a>
│   .   .   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage">drawImage()</a>
│   .   .   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/fillText">fillText()</a>
│   .   .   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/restore">restore()</a>
│   .   .   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/rotate">rotate()</a>
│   .   .   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/save">save()</a>
│   .   .   └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/translate">translate()</a>
└── <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement">HTMLImageElement</a>
.   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement#Constructor">Constructor</a>
.   │   └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/Image">Image()</a>
.   └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement#Properties">Properties</a>
.   .   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/width">width</a>
.   .   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/height">height</a>
.   .   └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/src">src</a>
</pre></code></p>
<h2>Event-driven programming</h2>
<p>Neither OOP nor <a href="https://en.wikipedia.org/wiki/Functional_programming">FP</a> comfortably support what
Erlang's late founder Joe Armstrong termed
<a href="https://erlang.org/download/armstrong_thesis_2003.pdf">concurreny-oriented programming</a>, specifically
<a href="https://en.wikipedia.org/wiki/Event-driven_programming">event-driven programming</a>, which is related to
<a href="https://developers.redhat.com/blog/2017/06/30/5-things-to-know-about-reactive-programming/">
reactive programming</a>.</p>
<p><q>This nomenclature is a bit confusing, and has its origin in early operating-systems research. It refers to how communication is done between multiple concurrent processes. In a thread-based system, communication is done through a synchronized resource such as shared memory. In an event-based system, processes generally communicate through a queue where they post items that describe what they have done or what they want done, which is maintained by our single thread of execution. Since these items generally describe desired or past actions, they are referred to as 'events'</q> —
<a href="http://aosabook.org/en/500L/an-event-driven-web-framework.html">An Event-Driven Web Framework</a>, Leo Zovic</p>
<p>Event-driven programming can broadly be split into three steps:</p>
<ol>
  <li>Listeners: In JavaScript, these are created with <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener">
target.addEventListener(type, listener [, options]);</a> where
<a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget">target</a> is Window, Document, or other HTML element,
and <a href="https://developer.mozilla.org/en-US/docs/Web/Events">type</a> is something like "keyup", "keydown", or "click".
</li>
  <li>Handlers: This is addEventListener's second argument, a <a href="">callback</a> called <em>listener</em> 
     in the documentation.</li>
  <li>A <a href="https://en.wikipedia.org/wiki/Event_loop">listening loop</a> &mdash; the body of a concurrent system.</li>
</ol>
<h2>Step 1: Attaching listeners to <em>targets</em></h2>
<p>My adaption from the Python original, which assumed the game
was going to be played on a PC with a keyboard, involved adding touch input for mobile phones. After initially experimenting
with the <a href="https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent">Touch Events API</a>, using
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/touchstart_event">touchstart</a> and
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/touchend_event">touchend</a> attached the canvas,
I switched to including buttons in my HTML and then using
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Pointer_events">Pointer Events</a>
which make a mouse and a finger touch on a mobile phone identical. The buttons also provide a visual clue to website
visitors with keyboards which keys will work.</p>
<p>I'll maybe use what I learned about touch events for mobile specific designs in future.</p>
<p>The user interface was created by attaching event listeners to the DOM as follows:</p>
<pre class="prettyprint source lang-javascript"><code>document.addEventListener(&quot;keydown&quot;, uiListener);
document.addEventListener(&quot;keyup&quot;, uiListener);
document.querySelector(&quot;#upButton&quot;).addEventListener(&quot;pointerdown&quot;, uiListener);
document.querySelector(&quot;#upButton&quot;).addEventListener(&quot;pointerup&quot;, uiListener);
document.querySelector(&quot;#leftButton&quot;).addEventListener(&quot;pointerdown&quot;, uiListener);
document.querySelector(&quot;#leftButton&quot;).addEventListener(&quot;pointerup&quot;, uiListener);
document.querySelector(&quot;#rightButton&quot;).addEventListener(&quot;pointerdown&quot;, uiListener);
document.querySelector(&quot;#rightButton&quot;).addEventListener(&quot;pointerup&quot;, uiListener);
document.querySelector(&quot;#spaceBar&quot;).addEventListener(&quot;pointerdown&quot;, uiListener);
document.querySelector(&quot;#spaceBar&quot;).addEventListener(&quot;pointerup&quot;, uiListener);
</code></pre>
<p>Like many other programming languages, JavaScript lets you just use the function name with no arguments when invoking it as a
<em>first-class citizen</em>, ie a paramater in another function, if the only argument is one generated,
which magically reappears where the function is defined.</p>
<p>The reason I converted it to pass <code>inputStates</code> as an argument even though it's a global constant is it's a
discipline enforced by testing framework Jasmine.</p>
<p>Besides user input events, there are other types of events which weren't immediately obvious to me. These include the many
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window#Events">Window events</a> which tell us when to initialise
the program because a browser has opened the page, stop things like sound loops when the user closes the tab, and also
react to events like the browser window getting resized or the orientation of a mobile phone getting changed.</p>
<p>A snag I initiallyl hit was JavaScript's dreaded &quot;white screen of death&quot; caused by the background image not loading by the time
the page was rendered. My initial attempt to fix this worsened the problem by introducing more JavaScript horrors,
a &quot;pyramid of doom&quot; along with an async-await blockage.</p>
<pre class="prettyprint source lang-javascript"><code>window.addEventListener(&quot;DOMContentLoaded&quot;, async function(event1) {
  await backgroundImage.addEventListener(&quot;load&quot;, function (event2) {
    ...
  });
});
</code></pre>
<p>I taught myself JavaScript testing framework Jasmine concurrently while doing this project, and an important lesson was
the value of keeping things separate and independent. All I wanted from the image was two numbers, which could easily
be supplied as parameters, thereby solving the mystery of the &quot;white screen of death&quot;.</p>
<pre class="prettyprint source lang-javascript"><code>const BASE_WIDTH = 800;
const BASE_HEIGHT = 600;
...
window.addEventListener(&quot;DOMContentLoaded&quot;, (event) => setup(BASE_WIDTH, BASE_HEIGHT, event));
window.addEventListener(&quot;unload&quot;, cleanup);
window.addEventListener(&quot;resize&quot;, resizeListener);
</code></pre>
<p>An even less obvious type of event are those required to write concurrent JavaScript, which I'll digress into briefly here.</p>
<h3>The Medium is the Message</h3>
<p>Among the nice things about learning to program by developing games is it brings concurrency to life.</p>
<p>Multithreading has been added to JavaScript via
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API">Web Workers</a>,
and distributed computing via
<a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_client_applications">
WebSockets</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API">Service Workers</a>.</p>
<p>These are all triggered by an event type called &quot;message&quot;, adding a style of programming known as the
<a href="https://en.wikipedia.org/wiki/Actor_model">actor model</a>, which though fairly easy once you go &quot;Aha!&quot;,
involves quite a learning curve for anyone schooled in only OOP and FP.</p>
<p>Alan Kay, who coined the term object-oriented programming, saw messaging as a core part of the concept, which sadly
got completely forgotten by the currently top-of-the-pops OOP languages.</p>
<p><q>Smalltalk's design — and existence — is due to the insight that everything we can describe can be represented by the recursive composition of a single kind of behavioral building block that hides its combination of state and process inside itself and can be dealt with only through the exchange of messages.</q> — <a href="http://worrydream.com/EarlyHistoryOfSmalltalk/">The Early History Of Smalltalk</a>, Alan Kay</p>
<p>Mercifully I tackled this after teaching myself Erlang, because I don't think I could have figured it out from the
JavaScript exlanations I've seen.</p>
<p>Step 1 is what Erlang calls spawning a process, which with JavaScript is done by:</p>
<pre class="prettyprint source lang-javascript"><code>const stateWorker = new Worker(&quot;state-loop.js&quot;);
</code></pre>
<p>What Erlang does with <em>ProcessID ! Message</em>, JavaScript does with</p>
<pre class="prettyprint source lang-javascript"><code>&lt;code>stateWorker.postMessage(request)&lt;/code>
</code></pre>
<p>I've called the code run by the worker a loop to follow Erlang convention where to keep processes alive to handle repeated
messages, they need to be written as a recursive loop. JavaScript workers automagically run as infinite listening loops which
carry on running until <code>stateWorker.terminate()</code> is called.</p>
<p>The file loaded by the Worker corresponds to an Erlang <code>receive pattern1 -&gt; action1, pattern2 -&gt; action2, ... end</code>
block.</p>
<pre class="prettyprint source lang-javascript"><code>this.addEventListener(&quot;message&quot;, function(event) {
  let reply;
  case (event.data.type) {
    &quot;type1&quot;:
       reply = ...;
       this.postMessage(reply); // if a reply is needed
       break;
    &quot;type2&quot;:
       reply = ...
    .... 
  }
});
</code></pre>
<p>Making the message contained in event.data an object with an attributed called type is my own convention. A big lesson
from Erlang's OTP patterns is that judicious choice of the compound data structure used as the message and naming
conventions creates a powerful <a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL</a>.</p>
<p>Erlang's OTP uses the convention of making its <em>type</em>call if the listening loop needs to reply, or
cast if the request only involves changing the loop state. In this example, messages saying the left or right arrow
have been pressed involve changing local variables, making them <em>casts</em> in Erlang terminology. Pressing the
space bar or up arrow, on the other hand, require sound effects which the worker thread can't do.</p>
<p>A early mistake I made learning this was I sent an object to the worker thread containing a pointer to a binary blob
(a sound buffer, but an image would have been as bad).
Thereby I discovered an important subtlety is that the main file sends the worker a
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm">structured clone</a>,
not a reference, so trying to share binary data either doesn't work or slows things down.</p>
<p>Long story short, limit the data communicated between the worker and main threads to strings and numbers, no references.</p>
<p>Replies from the worker are received as events by a listener attached to the worker:</p>
<pre class="prettyprint source lang-javascript"><code>function stateWorkerListener(event) {
  ... do something with event.data ...
}

stateWorker.addEventListener(&quot;message&quot;, stateWorkerListener);
</code></pre>
<p>https://stackoverflow.com/questions/50812026/is-there-some-kind-of-load-event-for-web-workers</p>
<p>Whereas modules and their client files can share globals via their shared <em>window</em> root object, a mantra of this style
of programming is <em>shared nothing</em>.</p>
<p>This required quite a lot of refactoring when I decided to move the <em>physics engine</em> portion of the game —
the relatively maths heavy job of iterating through a list of sprites to update their positions, check for collissions,
and filter out <em>dead</em> sprites — by what in Erlang terminology would be called spawning a process, and JavaScript
calls instantiating a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Worker">Worker</a>.</p>
<p>The main script communicates with  where <em>request</em>
acts as arguments which callback function <em>spritesUpdateListener(event)</em> which would receive the result from
in <em>event.data</em></p>
<p>The <em>sprites-updates.js</em> file would follow this template:</p>
<p>One of the advantages of this is encourages modularisation. Another is it makes better use of modern hardware. With even
cellphones today being multicore computers, it frees the main thread to do animation while other processors do trigonometry etc.</p>
<h2>Step 2. Writing Handlers</h2>
<h3>Testing events</h3>
<p>I started this project before learning test framework Jasmine, which turned into a lesson of the importance of test-first
development.</p>
<p>Putting a block like this near the top of the file</p>
<pre class="prettyprint source lang-javascript"><code>const BASE_WIDTH = 800;
const BASE_HEIGHT = 600;
const THRUST_SPEED = 0.1;
const RECOIL = -0.05;
const ROTATE_RATE = 60;
const MISSILE_SPEED = 4;
</code></pre>
<p>is known as <em>single point of control</em>, a good design principle. A bad habit I got into, however, was then
using these constants within functions, hitting a snag with Jasmine that it refuses to see globally defined constants
or variables, unless they've been attached to the window object.</p>
<p>Though it got me cursing at first, I realised this was an important lesson on modularity: making assumptions about things
outside a function's local scope is dangerous.</p>
<p>While there are a lot of <em>addEventListeners</em> attached to various targets, the number of handlers is fairly small.</p>
<p>I managed to abstract all the user interface handlers down to
<a href="http://www.seatavern.co.za/doc/global.html#uiListener">uiListener(event)</a>. I treat the event object as a pattern
to be matched with a responding action, making its template what HTDP would call an
<a href="https://htdp.org/2020-8-1/Book/part_one.html#%28part._sec~3aenums%29">enumeration</a>.</p>
<p>For this I used JavaScript's <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/switch">
switch</a> block — of which I ended up using two in uiListener: the first matches the type of event —
key or ponter up or down — and if it was a left, right, up or space button, which for pointer events
requires id of the target. Whether it's left, right, up or space is then matched in the second switch block.</p>
<p>From an Erlang perspective, JavaScript <em>pattern -&gt; action</em> code looks very long winded, requiring several
switch blocks as in <em>addEventListeners</em> for stuff that Erlang's more sophisticated pattern matching and guards
could do in one.</p>
<p>I've seen some JavaScript stylists advocating avoiding switch statements in
favour of lots of <code>if (predicate1) {...} else if (predicate2) {...} else if...</code>, which I personally find
uglier and more prone to bugs.</p>
<p>A gotcha in JavaScript is its switch statements are <em>fall through</em>, which means that unless you end a
<code>case</code> stanza with <code>break;</code> or <code>return;</code>, it continues to check if it matches further
patterns.</p>
<p>The first <code>switch</code> block in <em>uiListener</em> uses break since I want to continue to the second block. There
I can use return since that pattern has been actioned.</p>
<p>A JSDoc gotcha that tripped me was to try and tag uiListener as <code>@callback</code> instead of <code>@function</code>, which
resulted in it getting ommited from the documentation. Presumably <code>@callback</code> is an alternative to
<code>@param</code> to only be used when the argument is a callback.</p>
<p>While I had little difficulty in getting the four user input keys to work, pressing any keys not listened to caused the programme
to freeze until I discovered that, counter-intuitively, the <code>default</code> statement should be
<code>event.preventDefault();</code>.</p>
<p>Another challenge was getting the browser to open a debugging console with F12 — which stopped working after keyboard
events were <em>captured</em> by my own function. The trick here was to write a case statement forwarding this key event
back to the document. To be fancy, I wrote <code>event.target.dispatchEvent(event);</code> rather than
<code>document.dispatchEvent(event);</code> just to test what the event.target property holds.</p>
<h3>3. The main/game/listening loop</h3>
<p>This is a function that calls itself recursively — so it never returns anything since it's an infinite loop. In
Erlang, it would have a parameter called state which it would update and pass back to itself.</p>
<p>In JavaScript, the loop is initially called and then repeatedly recursively called via
<a href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame">Window.requestAnimationFrame(callback)</a>
to set the rate the canvas is redrawn for animation to 60/second irrespective of the hardware (thereby avoiding a problem
old video games have of running unplayably quickly because processor speeds have increased).</p>
<pre class="prettyprint source lang-javascript"><code>function loop() {
  ...
  window.requestAnimationFrame(loop);
}
</code></pre>
<h2>Documenting</h2>
<p><q>Most languages come with a large collection of abstractions. Some are contributions by the language design team;
others are added by programmers who use the language. To enable effective reuse of these abstractions, their creators
must supply the appropriate pieces of documentation — a <em>purpose statement</em>, a <em>signature</em>, and
<em>good examples</em> — and programmers use them to apply abstractions.</q></p>
<p>After testing, the next hardest part fro me has been getting to grips with <a href="https://jsdoc.app/">JSDoc</a>.</p>
<p>I've also tried to follow the <a href="https://google.github.io/styleguide/jsguide.html">Google JavaScript Style Guide</a>,
with the exception of ignoring its views of trailing commas since I find leading commas far better.</p>
<h2>Coding</h2>
<p><q>Learning coding is like playing cards — you learn the rules, then you play, then you go back and learn the rules again,
then you play again.</q> — From Mozilla's
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API">Web audio concepts and usage</a> guide.</p>
<h3><a href="https://developer.mozilla.org/en-US/docs/Web/API">Web APIs</a></h3>
<p>Frontend web development boils down to familiarisation with the bewildering choice of Web APIs available, and
the goal of this first game was to learn a minimal subset to get animation, sound, and user interaction working.</p>
<p>Invariably there are at least four ways of doing anything with JavaScript, and guessing the correct one
involves knowing whether it is old or new, good or bad, functional or object-oriented,
synchronous or asynchronous, block or function scope...</p>
<p>Achieving a desired goal requires an encyclopaedic knowledge of many objects and their properties,
events and their handlers, and methods and their parameters — mercifully <a href="https://developer.mozilla.org/en-US/">
MDN</a> is an excellent reference.</p>
<p>These are the ones I've settled on for now. Making the game mobile friendly involved learning yet another Web API,
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Touch_events">Touch Events</a>, which I decided not
to add the diagram below since it was too crowded already.</p>
<p>I've attempted to draw a hierarchy of the objects I've used, though in JavaScript that's not easy.
For instance, though Document is a child of Window, and CanvasRenderingContext2D of HTMLCanvasElement etc,
coding convention is to treat each as a separate object.
<code>AudioContext</code> is initially addressed as a child of Window since it's the global, root object.</p>
<p><code><pre>
├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model">DOM</a>
│   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window">Window</a>
│   │   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window#Events">Properties</a>
│   │   │   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/innerWidth">innerWidth</a>
│   │   │   └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/innerHeight">innerHeight</a>
│   │   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window#Events">Events</a>
│   │   │   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/DOMContentLoaded_event">DOMContentLoaded</a>
│   │   │   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/unload_event">unload</a>
│   │   │   └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/resize_event">resize</a>
│   │   └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window#Methods">Methods</a>
│   │   .   └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/requestAnimationFrame">requestAnimationFrame()</a>
│   └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document">Document</a>
│   .   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document#Events">Events</a>
│   .   │   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/keydown_event">keydown</a>
│   .   │   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/keyup_event">keyup</a>
│   .   │   ├── <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/pointerdown_event">pointerdown</a>
│   .   │   └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/pointerup_event">pointerup</a>
│   .   └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document#Methods">Methods</a>
│   .   .   └── <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelector">querySelector()</a>
</pre></code></p>
<p>The entry point of my programme introduced me two notorious horrors of Javascript: the
<a href="https://javascript.info/callbacks#pyramid-of-doom">Pyramid of Doom</a> (also known as <q>Callback Hell</q>);
and the <q>White Screen of Death</q>, neither problem I've entirely solved.</p>
<p>I toyed with putting the code below into a function called <em>init()</em>, but decided to simply leave it in the body of
the script because making it a separate function didn't <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY</a>
or <a href="https://en.wikipedia.org/wiki/KISS_principle">KISS</a> anything. Furthermore, placing initialisation steps in a
block starting with <code>window.addEventListener(&quot;DOMContentLoaded&quot;, ...</code> seems more in keeping with
<em>event-driven programming</em> than creating an extraneous function.</p>
<pre class="prettyprint source lang-javascript"><code>window.addEventListener(&quot;DOMContentLoaded&quot;, async function (event1) {
  await backgroundImage.addEventListener(&quot;load&quot;, function (event2) {
    resize();
    sprites[0] = createSpaceship();
    for (let rock = 1; rock &lt;= 13; rock++) { 
      sprites[rock] = createAsteroid();
    }
    window.addEventListener(&quot;resize&quot;, resize);
    window.requestAnimationFrame(loop);
  });
});
</code></pre>
<p>A problem the above code addresses is I want my website to have <a href="https://developers.google.com/search/mobile-sites/mobile-seo/responsive-design">
responsive design</a> in that the <em>board</em> (ie canvas object) should use all the available screen real estate. To calculate this, the programme needs
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/innerWidth">window.innerWidth</a> and
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/innerHeight">window.innerHeight</a>, which if used before the window has completed
loading, will be <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/undefined">undefined</a>.</p>
<p>The base size (ie scale = 1.0) is provided by the width and height of the background image, which if read before the graphic file has finished downloading
will be <em>undefined</em>.</p>
<p>A pitfall most novices will fall into is that, without care, JavaScript will produce a garbage value for <code>scale</code> using <em>undefined</em>
for its calculation which canvas won't draw, leading to the dreaded <q>White Screen of Death</q> with no error messages or clues on the console.</p>
<p>Before unravelling the above code, lets look at the <em>new way</em>,
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises">promises</a>, using
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">fetch</a> which I've written the function to download sound files with:</p>
<pre class="prettyprint source lang-javascript"><code>function loadSound(url, audioNode) {
  fetch(url)
  .then((response) => response.arrayBuffer())
  .then((buffer) => audioCtx.decodeAudioData(buffer))
  .then((decodedData) => audioNode.buffer = decodedData);
}
</code></pre>
<p>Three asynchronous processes which are contingent on each other — the buffer property of the audio node needs data
decoded by the audio context, which in turn depends on a sound file that has to have finished downloading.
The <code>.then(...)</code> syntax lets us chain these three steps together in <em>sequential</em> steps, hiding the mind-bending concurrency.</p>
<p>The <em>old way</em> of doing this was to nest each subsequent asynchronous step in the callback of its predecessor, which for many contingent steps
would lead to very deeply nested, ugly code — the <q>Pyramid of Death</q>.</p>
<p>Mercifully, the initial <q>window then background image loaded before launchign the loop</q> chain only involves two steps,
so its pyramid of doom isn't very high. Preventing a <q>white screen of death</q>, however, involved the additional step of
invoking JavaScript's <a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous/Async_await">async function (...) {... await ...}</a> combination to avoid the loop getting started before <code>scale</code> was set correctly.</p>
<p>A fourth event, <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/resize_event">resize</a>, is attached to the window so the user
can make the board bigger or smaller by adjusting the size of their browser, or changing the orientation of their phone.</p>
<h4>How to stop?</h4>
<p>Frameworks which have an <em>init()</em> or <em>setup()</em> starting point tend to have a <em>stop(), terminate(),</em> or
<em>cleanup()</em> function to call at the end. I discovered I needed something like that after testing my site on a mobile phone
and discovering that when I closed a window but didn't shut down the browser, the sound continued. I attempted to fix
this with yet another event handler.</p>
<p>Again, in keeping with my home brewed <em>event-driven programming</em> style, everything goes into a main body code stanza
starting
with <code>window.addEventListener(&quot;unload&quot;,...</code> rather than a function.</p>
<pre class="prettyprint source lang-javascript"><code>window.addEventListener(&quot;unload&quot;, function (event) {
  backgroundSound.stop();
  thrustSound.stop();
  missileSound.stop();
  explosionSound.stop();
});
</code></pre>
<h4>State</h4>
<p>In Erlang, the recursive loop would have an argument — usually a compound data structure containing the various
things commonly called a <em>state</em> — which the body of the loop would alter according to messages sent to
it by handlers and then call itself with the new value.</p>
<p>Here, instead of what Erlang calls a <em>mailbox</em> and the C-family would call a <em>message queue</em>, messaging is
done by the handlers mutating global variables which the loop reads each iteration.</p>
<p><a href="http://www.seatavern.co.za/doc/inputStates.html">inputStates</a> is the core messaging mechanism the handlers
use to communicate to the game loop.
All the propertis of inputStates (with the exception of a sound buffer) are booleans, and I've followed Google's style of using a
<a href="https://google.github.io/styleguide/jsguide.html#naming-method-names">isFoo</a> convention. For some, I've gotten
into the habit of using <a href="https://en.wikipedia.org/wiki/Snake_case">snake case</a>, so find the JavaScript convention
of camelCase and PascalCase a bit alien, but am getting the hang of it.</p>
<p>Another core state variable is <a href="http://www.seatavern.co.za/doc/global.html#sprites">sprites</a>, a list (or
array as JavaScript calls lists) of <a href="http://www.seatavern.co.za/doc/Sprite.html">sprite</a> elements. In
this game, I've made a convention that the spaceship sprite (which somethimes mutates briefly into an explosion
when it collides with an asteroid) can be accessed as <code>sprites[0]</code>.</p>
<h4>List processing</h4>
<p>A really powerful idea from <em>functional programming</em> (FP to its friends) is breaking problems down iterating over
lists, applying the same function to each element depending on which of three categories the task at hand falls into:</p>
<ol>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map">map</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter">filter</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce">reduce</a></li>
</ol>
<p>Map and filter can be built out of reduce, which in pure functional programming languages is usually called <em>foldr</em>
(JavaScript has <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/ReduceRight">
for purists).</p>
<p>Since mutation is taboo in FP, the above traditional list processors all produce a new list. If we don't want a new list
(which for traditional functional programming languages would be for printing data from each list element on a screen), we
can use
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach">
forEach</a>, which makes all the whizing stuff on the screen with this one line of code:</p>
<pre class="prettyprint source lang-javascript"><code>  sprites.forEach(function (sprite) {draw(sprite); nextTick(sprite);});
</code></pre>
<p><a href="http://www.seatavern.co.za/doc/global.html#draw">draw(sprite)</a> obviously belongs in <em>forEach</em>
since it does the GUI equivalent of a print statement, but putting
<a href="http://www.seatavern.co.za/doc/global.html#nextTick">nextTick(sprite)</a> there would be frowned on by
FP purists since the position and other values of each sprite get changed. Since JavaScript encourages mutations
and changing the properties of objects referenced in the array rather than removing and appending new ones is a lot
less work for the programmer and computer, I've gone that route.</p>
<h4>Drawing and updating</h4>
<p>As Mozilla's <a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Basic_animations">Basic Animations</a>
guide explains, the <code>...</code> above expands into broadly three steps:</p>
<ol>
<li>Clear the canvas with <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/clearRect">ctx.clearRect()</a> and create a fresh background.</li>
<li>Iteratively draw each sprite in these steps:
  <ol>
    <li>Save the canvas state with <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/save">ctx.save();</a></li>
    <li>Move to centre of rotation <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/translate">ctx.translate(x, y);</a></li>
    <li>Swivel image <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/rotate">ctx.rotate(angle);</a></li>
    <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage">
      ctx.drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);</a></li>
    <li>Restore the canvas state with <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/restore">ctx.restore();</a></li>
  </ol>
</li>
<li>Update the position of each sprite before they're drawn again to make them move.</li>
</ol>
<p>Writing nextTick got me to dust off the trigonometry and physics I learned way back in the last century. While my goal
was to keep the game as simple as possible so as to focus on learning JavaScript and its related tools, I couldn't
help making the spaceship recoil a bit when it fires a missile to force the player to use the thruster... I was also
tempted to make the asteroids bounce off each other like billiard balls, but I'll save that for a future version.</p>
<p>In conclusion, writing this game taught me a lot. Besides encountering many of the problems with JavaScript and hopefully
finding ways to overcome them — a neverending quest I suspect.</p>
<p>this document will already make most readers say tl;dr so I'll rather proceed to my next project, creating a dungeon crawler
specifically designed for mobile phones, with only touch user intput.</p></article>
    </section>









<section>

<header>
    
        <h2>game1.js</h2>
        
    
</header>

<article>
    <div class="container-overview">
    
        
            <div class="description">A simple arcade game translated to JavaScript from a
<a href="https://www.coursera.org/learn/interactive-python-1">Python Mooc</a> given by Rice University.</div>
        

        


<dl class="details">

    

    

    

    

    

    

    

    

    
    <dt class="tag-author">Author:</dt>
    <dd class="tag-author">
        <ul>
            <li>Robert Laing</li>
        </ul>
    </dd>
    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="game1.js.html">game1.js</a>, <a href="game1.js.html#line1">line 1</a>
    </li></ul></dd>
    

    

    

    
</dl>


        
    
    </div>

    

    
        <h3 class="subsection-title">Requires</h3>

        <ul>
            <li>module:rice-rocks.js</li>
        </ul>
    

    

    

    

    

    

    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-image.html">image</a></li><li><a href="module-sound.html">sound</a></li><li><a href="module-state-loop.html">state-loop</a></li></ul><h3>Global</h3><ul><li><a href="global.html#animationLoop">animationLoop</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Fri Aug 07 2020 12:53:10 GMT+0200 (South Africa Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>